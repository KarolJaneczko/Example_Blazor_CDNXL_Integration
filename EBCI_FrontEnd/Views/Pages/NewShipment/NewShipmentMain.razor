@page "/new-shipment"
@using EBCI_FrontEnd.Models.Shipment
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Web
@inject NavigationManager Navigation

<PageTitle>New shipment form</PageTitle>

<div class="ns-card">
    <header class="ns-card-header">
        <h1 class="ns-title">Add new shipment</h1>
        <p class="ns-subtitle">Fill the required fields and submit the shipment.</p>
    </header>

    <EditForm Model="NewShipment" OnValidSubmit="Submit" FormName="NewShipmentForm" class="ns-form">
        <DataAnnotationsValidator />
        <ValidationSummary class="ns-validation-summary" />

        <div class="ns-grid">
            <div class="ns-field">
                <label class="ns-label" for="supplier">
                    Supplier code
                    <span class="ns-required">*</span>
                </label>

                <div class="ns-input-group">
                    <span class="ns-icon">🏷️</span>
                    <InputText id="supplier"
                               class="ns-input"
                               @bind-Value="NewShipment.SupplierCode"
                               placeholder="E.g. SUP-123" />
                </div>
                <ValidationMessage For="@(() => NewShipment.SupplierCode)" class="ns-field-validation" />
            </div>

            <div class="ns-field">
                <label class="ns-label" for="shipmentDate">Shipment date <span class="ns-required">*</span></label>
                <div class="ns-input-group">
                    <span class="ns-icon">📅</span>
                    <InputDate id="shipmentDate"
                               class="ns-input"
                               @bind-Value="NewShipment.ShipmentDate" />
                </div>
                <ValidationMessage For="@(() => NewShipment.ShipmentDate)" class="ns-field-validation" />
            </div>

            <div class="ns-field ns-full">
                <label class="ns-label" for="warehouse">Warehouse code <span class="ns-required">*</span></label>
                <div class="ns-input-group">
                    <span class="ns-icon">🏬</span>
                    <InputText id="warehouse"
                               class="ns-input"
                               @bind-Value="NewShipment.WarehouseCode"
                               placeholder="E.g. WH-A1" />
                </div>
                <ValidationMessage For="@(() => NewShipment.WarehouseCode)" class="ns-field-validation" />
            </div>
        </div>

        <footer class="ns-actions">
            <button type="submit" class="ns-btn ns-btn-primary">Save shipment</button>
            <button type="button" class="ns-btn" @onclick="Cancel">Cancel</button>
        </footer>

        @if (!string.IsNullOrEmpty(StatusMessage)) {
            <div class="ns-status @(IsSuccess ? "ns-success" : "ns-error")" role="status">
                @StatusMessage
            </div>
        }
    </EditForm>
</div>

@code {
    [SupplyParameterFromForm]
    private Shipment NewShipment { get; set; }

    private string StatusMessage { get; set; }
    private bool IsSuccess { get; set; }

    protected override void OnInitialized() =>
        NewShipment ??= new() {
            SupplierCode = string.Empty,
            ShipmentDate = DateTime.Now,
            WarehouseCode = string.Empty,
            Positions = Array.Empty<ShipmentPosition>()
        };

    private void Submit() {
        // Basic client feedback — replace with server call / API as needed
        IsSuccess = true;
        StatusMessage = $"Shipment for supplier '{NewShipment.SupplierCode}' scheduled for {NewShipment.ShipmentDate:d} saved.";
        // TODO: call backend API, show spinner, handle errors
    }

    private void Cancel() {
        Navigation.NavigateTo("/");
    }
}